---
title: "Frequency of Diabetes Among Women of Pima Indigenous Heritage Living Near Phoenix, Arizona"
output: html_document
date: "2023-07-31"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Installing Libraries

This chunk installs the required libraries to form the chats needed to explain the data for the final project.

```{r packages}
if(!require(pacman))install.packages("pacman")

pacman::p_load('dplyr', 'tidyr', 'gapminder',
               'ggplot2',  'ggalt',
               'forcats', 'R.utils', 'png', 
               'grid', 'ggpubr', 'scales',
               'bbplot')

library(ggplot2)
library(dplyr)
```

## Diabetes DataFrame

The diabetes dataframe comes from Datahub.io. It appears in Kaggle and many research papers regarding the frequency of diabetes among indigenous Native American people. The columns included in the table are:
Pregnancies - Number of pregnancies.
GlucoseLevel - Blood glucose level.
BloodPressure - Blood pressure measurement taken at the time of the study.
SkinThickness - Skin thickness.
Insulin - Blood insulin levels.
BMI - Body Mass Index.
DiabetesPedigreeFunction - A measure of genetic influence that provides data on diabetes mellitus history in relatives and the genetic relationship of those relatives to the patient.
Age - The woman's age.
Outcome - Tested either positive or negative for diabetes.

```{r read file, echo=FALSE}
file = "https://datahub.io/machine-learning/diabetes/r/diabetes.csv"
diabetesData <- read.csv(file)

# Replaces 0s in all columns with NAs except for preg and class.
diabetesData$plas[diabetesData$plas == 0] <- NA
diabetesData$pres[diabetesData$pres == 0] <- NA
diabetesData$skin[diabetesData$skin == 0] <- NA
diabetesData$insu[diabetesData$insu == 0] <- NA
diabetesData$mass[diabetesData$mass == 0] <- NA
diabetesData$pedi[diabetesData$pedi == 0] <- NA

# Drops rows with NAs in all columns except for preg and class.
diabetesData <- na.omit(diabetesData)

# Renames columns for easier readability
diabetesData <- data.frame(Pregnancies=diabetesData$preg, GlucoseLevel=diabetesData$plas, BloodPressure=diabetesData$pres, SkinThickness=diabetesData$skin, Insulin=diabetesData$insu, BMI=diabetesData$mass, DiabetesPedigreeFunction=diabetesData$pedi, Age=diabetesData$age, Outcome=diabetesData$class)

head(diabetesData)
```

## Frequency of Diabetes Between Age and Number of Pregnancies

Plot 1 measures the frequency of diabetes in women of Pima indigenous heritage living near Phoenix, Arizona as they age. Older women are more likely to be tested positive for diabetes than younger women.

```{r age diabetic plot, echo=FALSE}
ggplot(diabetesData, aes(x=Outcome, y=Age)) + geom_point(position="Jitter", width=0.25, alpha=0.5) + labs(y="Age", x="Diabetes Status", title="Frequency of Diabetes in Women", subtitle="Of Pima indigenous heritage near Phoenix, AZ") + theme(legend.position = "top", legend.justification = "left") + bbc_style() + theme(axis.title = element_text())
```
## Frequency of Diabetes Between Age and Number of Pregnancies

Plot 2 measures the frequency of diabetes in women of Pima indigenous heritage living near Phoenix, Arizona as they age or have more children. The older the woman, the more likely she gets diabetes. Women who had more children are more likely to be tested positive for diabetes. Women who had about 5 or more children tend to have a higher percentage of positive diabetes diagnosis.

```{r age pregnancies, echo=FALSE}
ggplot(diabetesData, aes(x=Pregnancies, y=Age, color=Outcome)) + geom_point(position="Jitter", width=0.25, alpha=0.5) + labs(y="Age", x="Number of Pregnancies", title="Frequency of Diabetes in Women", subtitle="Of Pima indigenous heritage near Phoenix, AZ") + theme(legend.position = "top", legend.justification = "left") + bbc_style() + theme(axis.title = element_text()) + scale_colour_manual(values = c("#2D9900", "red"))
```

## Frequency of Diabetes Between Age and Blood Pressure Level

Plot 3 measures the frequency of diabetes between age and blood pressure. In general, those who are older and have higher blood pressure tend to be tested for diabetes.

```{r age blood pressure plot, echo=FALSE}
ggplot(diabetesData, aes(x=BloodPressure, y=Age, color=Outcome)) + geom_point(position="Jitter", width=0.25, alpha=0.5) + labs(y="Age", x="Blood Pressure Level", title="Frequency of Diabetes in Women", subtitle="Of Pima indigenous heritage near Phoenix, AZ") + theme(legend.position = "top", legend.justification = "left") + bbc_style() + theme(axis.title = element_text()) + scale_colour_manual(values = c("#2D9900", "red"))
```
## Frequency of Diabetes Between BMI and Blood Glucose Level

Plot 4 measures the frequency of diabetes between blood glucose level and BMI. In general, women with higher blood glucose level and higher BMI are at risk of diabetes.

```{r bmi glucose level plot, echo=FALSE}
ggplot(diabetesData, aes(x=GlucoseLevel, y=BMI, color=Outcome)) + geom_boxplot(outlier.shape=NA) + geom_jitter(alpha=0.5) + labs(y="BMI", x="Blood Glucose Level", title="Frequency of Diabetes in Women", subtitle="Of Pima indigenous heritage near Phoenix, AZ") + theme(legend.position = "top", legend.justification = "left") + bbc_style() + theme(axis.title = element_text()) + scale_colour_manual(values = c("#2D9900", "red"))
```
## Frequency of Diabetes Between Insulin Level and Blood Glucose Level

Plot 5 measures the frequency of diabetes between insulin level and blood glucose level. In general, people wit higher glucose level and lower insulin level are at risk of diabetes.

```{r insulin glucose levels plot, echo=FALSE}
ggplot(diabetesData, aes(x=Insulin, y=GlucoseLevel, color=Outcome)) + geom_boxplot(outlier.shape=NA) + geom_jitter(alpha=0.5) + labs(y="BMI", x="Blood Glucose Level", title="Frequency of Diabetes in Women", subtitle="Of Pima indigenous heritage near Phoenix, AZ") + bbc_style() + theme(axis.title = element_text()) + scale_colour_manual(values = c("#2D9900", "red"))
```
## Frequency of Diabetes in Different Skin Thickness

Plot 6 measures the frequency of diabetes between different skin thickness. In general, women with thicker skin tend to be at risk of having diabetes.

```{r skin thickness plot, echo=FALSE}
ggplot(diabetesData, aes(x=Outcome, y=SkinThickness)) + geom_boxplot(outlier.shape=NA) + geom_jitter(alpha=0.5) + labs(y="Skin Thickness", x="Diabetes Status", title="Frequency of Diabetes in Women", subtitle="Of Pima indigenous heritage near Phoenix, AZ") + theme(legend.position = "top", legend.justification = "left") + bbc_style() + theme(axis.title = element_text()) + scale_colour_manual(values = c("#2D9900", "red"))
```
## Frequency of Diabetes in Different Skin Thickness and BMI

Plot 7 measures the frequency of diabetes between skin thickness and BMI. Women with higher BMI have thicker skins. In general, diabetic women have thicker skin and higher BMI.

```{r bmi skin thickness plot, echo=FALSE}
ggplot(diabetesData, aes(x=BMI, y=SkinThickness, color=Outcome)) + geom_boxplot(outlier.shape=NA) + geom_jitter(alpha=0.5) + labs(y="Skin Thickness", x="BMI", title="Frequency of Diabetes in Women", subtitle="Of Pima indigenous heritage near Phoenix, AZ") + theme(legend.position = "top", legend.justification = "left") + bbc_style() + theme(axis.title = element_text()) + scale_colour_manual(values = c("#2D9900", "red"))
```
## Frequency of Diabetes in Family History

Plot 8 measures the frequency of diabetes in the diabetes pedigree function. The diabetes pedigree function is a function that measures the likelihood of diabetes based on family history. A higher value in the diabetes pedigree function indicates that the woman is at a higher risk of having diabetes. Diabetic women have a higher pedigree function value than those who are not diabetic.

```{r diabetes pedigree function, echo=FALSE}
ggplot(diabetesData, aes(x=Outcome, y=DiabetesPedigreeFunction)) + geom_boxplot(outlier.shape=NA) + geom_jitter(alpha=0.5) + labs(y="Diabetes Pedigree Family History", x="Diabetes Status", title="Frequency of Diabetes in Women", subtitle="Of Pima indigenous heritage near Phoenix, AZ") + theme(legend.position = "top", legend.justification = "left") + bbc_style() + theme(axis.title = element_text()) + scale_colour_manual(values = c("#2D9900", "red"))
```

## Frequency of Diabetes Apriori

The Apriori rules compare the risk of diabetes occuring under different body conditions, such as number of Pregnancies, Blood Glucose Level, Blood Pressure, Skin Thickness, Insulin level, BMI, and Age.

```{r apriori, echo=FALSE}
set.seed(3)
appearance = list(default = "lhs", rhs = ("Outcome=tested_positive"))
parameter = list(supp = 0.001, conf = 0.8)

library(arules)
library(arulesViz)

# Converts data frame to transactions.
trans <- as(diabetesData, "transactions")

#Uses apriori() function on diabetic people.
rules <- apriori(trans, parameter = parameter, appearance = appearance)

# Views rules.
inspect(rules)
```
Uses arulesViz to visualize the results.

```{r}
# BEGIN SOLUTION
library(arulesViz)

plot(rules, main = "Diabetes")
"
[The x axis represents the support while the y axis represents the confidence or lift. Support indicates how frequently a set of items appear in the data. It is the number of transactions that contains this set. Confidence or lift indicates how often the support rule is true. Lift is a measure of association using both support and confidence. The lift value of an association rule includes the list of rules whose confidence is above the threshold.]
"
# END SOLUTION
```
Sorts the list of previously created rules and uses lift > 2.9 to find the best rules.
```{r}
# BEGIN SOLUTION
# Sort the list of previously created rules.
sortedRules <- sort(rules)

# Uses lift > 0.99 to find the best rules.
subrules <- subset(sortedRules, lift>2.9)
plot(subrules)
```